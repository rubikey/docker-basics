services:
  proxy:
    image: 'jc21/nginx-proxy-manager:latest'
    container_name: proxy-manager
    restart: unless-stopped
    ports:
      - '80:80' # Standard HTTP
      - '81:81' # Administration Proxy Manager Panel
      - '443:443' # HTTPS
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt


  app-web:
    build: .          # Dockerfile Path
    container_name: web-server
    restart: always
    volumes:
      - ./index.html:/usr/share/nginx/html/index.html
    

  
  db:
    image: mariadb:11.4.9
    container_name: db-server
    restart: always
    environment:
      MARIADB_ROOT_PASSWORD: password123
      MARIADB_DATABASE: app_users
    volumes: 
      - mysql-data:/var/lib/mysql
 

  # Monitoring
  dozzle:
    image: amir20/dozzle:latest
    container_name: utils-dozzle
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro # Allow to read all container logs 

    ports:
      - 8888:8080


  backup-db:
    image: fradelg/mysql-cron-backup
    container_name: utils-db-backup
    restart: unless-stopped
    volumes:
      - ./backups:/backup     
    depends_on:
      - db
    environment:
      - MYSQL_HOST=db
      - MYSQL_PORT=3306
      - MYSQL_USER=root
      - MYSQL_PASS=password123
      - CRON_TIME=0 3 * * * # at 3:00 AM everyday
      - MAX_BACKUPS=7
      - INIT_BACKUP=0           


  # ad-block
  adguard:
    image: adguard/adguardhome
    container_name: utils-adguard
    restart: unless-stopped
    ports:
      - "53:53/tcp"   # DNS
      - "53:53/udp"   # DNS
      - "3000:80/tcp"   # admin panel (port 3000)
      - "3001:3000/tcp"
    volumes:
      - ./adguard-data:/opt/adguardhome/work
      - ./adguard-config:/opt/adguardhome/conf





volumes:
 mysql-data:
